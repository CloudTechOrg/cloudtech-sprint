# スプリント4：静的サイトホスティング ハンズオン課題

## 背景

あなたは、とあるWebサービスを運営する企業で、インフラエンジニアとして働いています。

この度、新しく企業のコーポレートサイトをリリースすることになりました。

このサイトは、シンプルな静的サイト（HTML/CSS/JavaScript）で構成されており、サーバサイドの処理は必要ありません。

インフラチームには以下の要望が寄せられています。

- サーバの管理・運用の手間をかけたくない
- アクセス数の増減に柔軟に対応できるようにしたい
- ユーザがストレスなく閲覧できる高速な表示を実現したい
- 独自ドメインでHTTPS通信を行い、セキュアなサイトにしたい

静的サイトのファイルはすでに、開発チームが用意してくれています。

あなたはインフラエンジニアとして、これらの要望を満たすインフラ環境を構築する必要があります。

## 実施手順

1. まずは要件を実現するための設計として、AWS構成図を作成しましょう。
2. 構成図に従い、実際にAWSで環境構築してみましょう。
3. 構築が終わったら、動作確認をしていきましょう。

## プロジェクト体制

| 担当 | チーム | 役割・タスク |
| :--- | :--- | :--- |
| **開発担当** | 開発チーム | ・アプリケーション開発<br>・サーバ構築のシェルスクリプト作成 |
| **あなた** | インフラチーム | ・AWS構成図作成<br>・AWS環境構築 |
| **メンター** | 支援チーム | ・成果物のレビュー<br>・技術サポート (CloudTech Academy受講生のみ) |

## 要件

### 要件1：静的ファイルの配置
- 静的サイトのファイル（HTML/CSS）をオブジェクトストレージに格納する
- オブジェクトストレージへの直接アクセスは許可せず、CDN経由でのみアクセスできるようにする

#### 使用する資材
- [こちらのファイル一式](https://github.com/CloudTechOrg/cloudtech-sprint/tree/main/content/sprint4/resource)をオブジェクトストレージに格納してください

### 要件2：CDNの利用
- CDN（コンテンツ配信ネットワーク）を使用して、世界中のユーザに高速にコンテンツを配信する
- オリジンとして、要件1で用意したオブジェクトストレージを指定する

### 要件3：独自ドメインの設定
- 独自ドメインでサイトにアクセスできるようにする
- ドメインはお名前.comなど任意のレジストラから取得してよい
- DNSを設定し、独自ドメインでCDNにアクセスできるようにする

### 要件4：HTTPS通信の実現
- サーバ証明書を取得し、CDNに対してHTTPS通信を可能にする

## 動作確認
- `https://<独自ドメイン>/` でアクセスしたとき、コーポレートサイトが表示されること
- HTTPSで接続されていること（ブラウザのアドレスバーに鍵マークが表示されること）

## トラブルシューティング

### サイトにアクセスできない（403 Forbidden）
- S3バケットポリシーでCloudFrontからのアクセスが許可されているか確認してください
- CloudFrontのオリジンアクセスコントロール（OAC）が正しく設定されているか確認してください
- S3バケットの「ブロックパブリックアクセス」設定を確認してください

### サイトにアクセスできない（404 Not Found）
- S3バケットにindex.htmlがアップロードされているか確認してください
- CloudFrontのデフォルトルートオブジェクトに `index.html` が設定されているか確認してください
- ファイル名の大文字・小文字が正しいか確認してください

### 独自ドメインでアクセスできない
- Route 53のホストゾーンにAレコード（エイリアス）が正しく設定されているか確認してください
- CloudFrontディストリビューションの「代替ドメイン名（CNAME）」に独自ドメインが追加されているか確認してください
- DNSの伝播に時間がかかる場合があるため、しばらく待ってから再度確認してください

### HTTPS接続ができない / 証明書エラーが表示される
- ACMで証明書が「発行済み」ステータスになっているか確認してください
- ACMの証明書は **バージニア北部（us-east-1）** リージョンで作成する必要があります
- 証明書のドメイン名が、アクセスしようとしているドメイン名と一致しているか確認してください
- 証明書の検証（DNS検証またはメール検証）が完了しているか確認してください

### 証明書の検証が完了しない
- DNS検証を選択した場合、Route 53にCNAMEレコードが正しく追加されているか確認してください
- ACMの画面から「Route 53でレコードを作成」ボタンを使用すると、自動でCNAMEレコードを追加できます
- レコード追加後、検証完了まで数分〜数十分かかる場合があります

### CloudFrontの変更が反映されない
- CloudFrontディストリビューションのステータスが「デプロイ済み」になるまで待ってください（数分かかります）
- ブラウザのキャッシュをクリアして再度アクセスしてください
- 必要に応じてCloudFrontのキャッシュを無効化（Invalidation）してください
