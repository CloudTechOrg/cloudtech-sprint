# スプリント11：データ分析基盤 ハンズオン課題

## 背景

あなたは、とある小売企業で、インフラエンジニアとして働いています。

現在、売上データはデータベースに蓄積されていますが、分析や可視化が十分に行われていません。経営層からは以下のような要望が出ています。

- 売上データをリアルタイムに近い形で分析したい
- データを視覚的に把握できるダッシュボードが欲しい
- SQLを使って柔軟にデータを検索・集計したい
- 分析用のデータは運用データベースに負荷をかけずに処理したい

これらの要望を実現するため、**データ分析基盤**を構築することになりました。運用データベースからデータを抽出・変換し、分析に適した形式で保存、そしてBIツールで可視化するパイプラインを構築します。

あなたはインフラエンジニアとして、このデータ分析基盤を構築する必要があります。

## 実施手順

1. まずは要件を実現するための設計として、AWS構成図を作成しましょう。
2. 構成図に従い、実際にAWSで環境構築してみましょう。
3. 構築が終わったら、動作確認をしていきましょう。

## 要件

### 要件1：データソースの準備
- リレーショナルデータベースに売上データを準備する
- 下記「サンプルデータ」を参照し、約100件のデータを投入する
- 構成については、無料利用枠の範囲とする

### 要件2：ETL処理
- データベースからデータを抽出する
- データを分析に適した列指向フォーマット（Parquet形式）に変換する
- 変換したデータをオブジェクトストレージに保存する

### 要件3：データカタログの作成
- ストレージに保存されたデータのスキーマ情報を自動的に検出する
- データカタログを作成し、クエリエンジンから参照できるようにする

### 要件4：クエリエンジンの設定
- ストレージ上のParquetファイルに対してSQLクエリを実行できるようにする
- 下記「動作確認用SQLクエリ」が正常に実行できることを確認する

### 要件5：データ可視化
- BIツールを使用して、売上データのダッシュボードを作成する
- 下記「ダッシュボード仕様」に従って、グラフを作成する

## 構築チェックリスト

下記が実装されていることを確認してください。

### 要件1：データソースの準備
- リレーショナルデータベースに売上データが準備されていること
- 約100件のデータが投入されていること

### 要件2：ETL処理
- データベースからデータが抽出されていること
- データがParquet形式に変換されていること
- 変換したデータがオブジェクトストレージに保存されていること

### 要件3：データカタログの作成
- ストレージに保存されたデータのスキーマ情報が自動的に検出されていること
- データカタログが作成され、クエリエンジンから参照できること

### 要件4：クエリエンジンの設定
- ストレージ上のParquetファイルに対してSQLクエリが実行できること
- 動作確認用SQLクエリが正常に実行できること

### 要件5：データ可視化
- BIツールでダッシュボードが作成されていること
- カテゴリ別売上構成（円グラフ）が表示されていること
- 月別売上推移（折れ線グラフ）が表示されていること
- 地域別売上比較（棒グラフ）が表示されていること
- 商品別売上ランキング（棒グラフ）が表示されていること

## サンプルデータ

### テーブル定義

**テーブル名**: `sales`

| カラム名 | データ型 | 説明 |
| :--- | :--- | :--- |
| id | INT | 売上ID（主キー） |
| sale_date | DATE | 売上日 |
| product_name | VARCHAR(100) | 商品名 |
| category | VARCHAR(50) | カテゴリ |
| region | VARCHAR(50) | 地域 |
| quantity | INT | 数量 |
| unit_price | INT | 単価 |
| total_amount | INT | 売上金額 |

### サンプルデータの内容

以下のような売上データを100件程度用意してください。

```sql
INSERT INTO sales (id, sale_date, product_name, category, region, quantity, unit_price, total_amount) VALUES
(1, '2024-01-05', 'ノートPC', '電子機器', '東京', 2, 80000, 160000),
(2, '2024-01-05', 'マウス', '電子機器', '大阪', 10, 2000, 20000),
(3, '2024-01-06', 'デスク', '家具', '東京', 1, 25000, 25000),
(4, '2024-01-06', 'チェア', '家具', '名古屋', 3, 15000, 45000),
(5, '2024-01-07', 'モニター', '電子機器', '福岡', 4, 30000, 120000),
-- ... 以下同様に100件程度
```

**データの特徴**:
- 期間：2024年1月〜3月（約3ヶ月分）
- カテゴリ：電子機器、家具、文房具、食品
- 地域：東京、大阪、名古屋、福岡、札幌
- 商品数：10種類程度

### Terraformコード（サンプルデータ投入用）

以下のTerraformコードを使用して、RDSインスタンスと踏み台サーバを作成し、ユーザーデータでサンプルデータを自動投入できます。

**ファイル構成**:
```
.
├── main.tf
├── variables.tf
├── outputs.tf
├── vpc.tf
├── rds.tf
└── bastion.tf
```

**variables.tf**:
```hcl
variable "db_username" {
  description = "RDS master username"
  type        = string
  default     = "admin"
}

variable "db_password" {
  description = "RDS master password"
  type        = string
  sensitive   = true
}

variable "key_name" {
  description = "EC2 key pair name"
  type        = string
}
```

**vpc.tf**:
```hcl
resource "aws_vpc" "main" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name = "sales-analytics-vpc"
  }
}

resource "aws_internet_gateway" "main" {
  vpc_id = aws_vpc.main.id

  tags = {
    Name = "sales-analytics-igw"
  }
}

resource "aws_subnet" "public_1" {
  vpc_id                  = aws_vpc.main.id
  cidr_block              = "10.0.1.0/24"
  availability_zone       = "ap-northeast-1a"
  map_public_ip_on_launch = true

  tags = {
    Name = "sales-analytics-public-1"
  }
}

resource "aws_subnet" "public_2" {
  vpc_id                  = aws_vpc.main.id
  cidr_block              = "10.0.2.0/24"
  availability_zone       = "ap-northeast-1c"
  map_public_ip_on_launch = true

  tags = {
    Name = "sales-analytics-public-2"
  }
}

resource "aws_route_table" "public" {
  vpc_id = aws_vpc.main.id

  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.main.id
  }

  tags = {
    Name = "sales-analytics-public-rt"
  }
}

resource "aws_route_table_association" "public_1" {
  subnet_id      = aws_subnet.public_1.id
  route_table_id = aws_route_table.public.id
}

resource "aws_route_table_association" "public_2" {
  subnet_id      = aws_subnet.public_2.id
  route_table_id = aws_route_table.public.id
}

resource "aws_db_subnet_group" "main" {
  name       = "sales-db-subnet-group"
  subnet_ids = [aws_subnet.public_1.id, aws_subnet.public_2.id]

  tags = {
    Name = "sales-db-subnet-group"
  }
}
```

**rds.tf**:
```hcl
resource "aws_db_instance" "sales_db" {
  identifier           = "sales-database"
  engine               = "mysql"
  engine_version       = "8.0"
  instance_class       = "db.t3.micro"
  allocated_storage    = 20
  storage_type         = "gp2"

  db_name  = "salesdb"
  username = var.db_username
  password = var.db_password

  vpc_security_group_ids = [aws_security_group.rds_sg.id]
  db_subnet_group_name   = aws_db_subnet_group.main.name

  publicly_accessible = false
  skip_final_snapshot = true

  tags = {
    Name = "sales-database"
  }
}

resource "aws_security_group" "rds_sg" {
  name        = "rds-security-group"
  description = "Security group for RDS"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port       = 3306
    to_port         = 3306
    protocol        = "tcp"
    security_groups = [aws_security_group.bastion_sg.id]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name = "rds-security-group"
  }
}
```

**bastion.tf**:
```hcl
resource "aws_security_group" "bastion_sg" {
  name        = "bastion-security-group"
  description = "Security group for Bastion"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name = "bastion-security-group"
  }
}

data "aws_ami" "amazon_linux_2023" {
  most_recent = true
  owners      = ["amazon"]

  filter {
    name   = "name"
    values = ["al2023-ami-*-x86_64"]
  }

  filter {
    name   = "virtualization-type"
    values = ["hvm"]
  }
}

resource "aws_instance" "bastion" {
  ami                    = data.aws_ami.amazon_linux_2023.id
  instance_type          = "t2.micro"
  key_name               = var.key_name
  subnet_id              = aws_subnet.public_1.id
  vpc_security_group_ids = [aws_security_group.bastion_sg.id]

  user_data = <<-EOF
#!/bin/bash
set -e

# MySQLクライアントのインストール
dnf install -y mariadb105

# RDSが起動するまで待機
sleep 120

# サンプルデータの投入
mysql -h ${aws_db_instance.sales_db.address} -u ${var.db_username} -p${var.db_password} ${aws_db_instance.sales_db.db_name} <<'EOSQL'
CREATE TABLE IF NOT EXISTS sales (
    id INT PRIMARY KEY,
    sale_date DATE NOT NULL,
    product_name VARCHAR(100) NOT NULL,
    category VARCHAR(50) NOT NULL,
    region VARCHAR(50) NOT NULL,
    quantity INT NOT NULL,
    unit_price INT NOT NULL,
    total_amount INT NOT NULL
);

INSERT INTO sales (id, sale_date, product_name, category, region, quantity, unit_price, total_amount) VALUES
(1, '2024-01-05', 'ノートPC', '電子機器', '東京', 2, 80000, 160000),
(2, '2024-01-05', 'マウス', '電子機器', '大阪', 10, 2000, 20000),
(3, '2024-01-06', 'デスク', '家具', '東京', 1, 25000, 25000),
(4, '2024-01-06', 'チェア', '家具', '名古屋', 3, 15000, 45000),
(5, '2024-01-07', 'モニター', '電子機器', '福岡', 4, 30000, 120000),
(6, '2024-01-07', 'キーボード', '電子機器', '東京', 8, 5000, 40000),
(7, '2024-01-08', 'ボールペン', '文房具', '大阪', 100, 150, 15000),
(8, '2024-01-08', 'ノート', '文房具', '札幌', 50, 200, 10000),
(9, '2024-01-09', 'コーヒー', '食品', '東京', 30, 500, 15000),
(10, '2024-01-09', 'お茶', '食品', '名古屋', 40, 300, 12000),
(11, '2024-01-10', 'ノートPC', '電子機器', '大阪', 3, 80000, 240000),
(12, '2024-01-10', 'マウス', '電子機器', '福岡', 15, 2000, 30000),
(13, '2024-01-11', 'デスク', '家具', '札幌', 2, 25000, 50000),
(14, '2024-01-11', 'チェア', '家具', '東京', 5, 15000, 75000),
(15, '2024-01-12', 'モニター', '電子機器', '名古屋', 2, 30000, 60000),
(16, '2024-01-12', 'キーボード', '電子機器', '大阪', 12, 5000, 60000),
(17, '2024-01-13', 'ボールペン', '文房具', '東京', 80, 150, 12000),
(18, '2024-01-13', 'ノート', '文房具', '福岡', 60, 200, 12000),
(19, '2024-01-14', 'コーヒー', '食品', '札幌', 25, 500, 12500),
(20, '2024-01-14', 'お茶', '食品', '大阪', 35, 300, 10500),
(21, '2024-01-15', 'ノートPC', '電子機器', '名古屋', 1, 80000, 80000),
(22, '2024-01-15', 'マウス', '電子機器', '東京', 20, 2000, 40000),
(23, '2024-01-16', 'デスク', '家具', '福岡', 3, 25000, 75000),
(24, '2024-01-16', 'チェア', '家具', '大阪', 4, 15000, 60000),
(25, '2024-01-17', 'モニター', '電子機器', '札幌', 3, 30000, 90000),
(26, '2024-01-17', 'キーボード', '電子機器', '名古屋', 10, 5000, 50000),
(27, '2024-01-18', 'ボールペン', '文房具', '大阪', 120, 150, 18000),
(28, '2024-01-18', 'ノート', '文房具', '東京', 70, 200, 14000),
(29, '2024-01-19', 'コーヒー', '食品', '福岡', 20, 500, 10000),
(30, '2024-01-19', 'お茶', '食品', '札幌', 45, 300, 13500),
(31, '2024-01-20', 'ノートPC', '電子機器', '東京', 4, 80000, 320000),
(32, '2024-01-20', 'マウス', '電子機器', '名古屋', 8, 2000, 16000),
(33, '2024-01-21', 'デスク', '家具', '大阪', 2, 25000, 50000),
(34, '2024-01-21', 'チェア', '家具', '福岡', 6, 15000, 90000),
(35, '2024-01-22', 'モニター', '電子機器', '東京', 5, 30000, 150000),
(36, '2024-01-22', 'キーボード', '電子機器', '札幌', 15, 5000, 75000),
(37, '2024-01-23', 'ボールペン', '文房具', '名古屋', 90, 150, 13500),
(38, '2024-01-23', 'ノート', '文房具', '大阪', 55, 200, 11000),
(39, '2024-01-24', 'コーヒー', '食品', '東京', 35, 500, 17500),
(40, '2024-01-24', 'お茶', '食品', '福岡', 30, 300, 9000),
(41, '2024-01-25', 'ノートPC', '電子機器', '札幌', 2, 80000, 160000),
(42, '2024-01-25', 'マウス', '電子機器', '大阪', 12, 2000, 24000),
(43, '2024-01-26', 'デスク', '家具', '名古屋', 1, 25000, 25000),
(44, '2024-01-26', 'チェア', '家具', '東京', 7, 15000, 105000),
(45, '2024-01-27', 'モニター', '電子機器', '福岡', 2, 30000, 60000),
(46, '2024-01-27', 'キーボード', '電子機器', '大阪', 18, 5000, 90000),
(47, '2024-01-28', 'ボールペン', '文房具', '札幌', 75, 150, 11250),
(48, '2024-01-28', 'ノート', '文房具', '名古屋', 40, 200, 8000),
(49, '2024-01-29', 'コーヒー', '食品', '大阪', 28, 500, 14000),
(50, '2024-01-29', 'お茶', '食品', '東京', 50, 300, 15000),
(51, '2024-02-01', 'ノートPC', '電子機器', '福岡', 3, 80000, 240000),
(52, '2024-02-01', 'マウス', '電子機器', '札幌', 18, 2000, 36000),
(53, '2024-02-02', 'デスク', '家具', '東京', 4, 25000, 100000),
(54, '2024-02-02', 'チェア', '家具', '大阪', 8, 15000, 120000),
(55, '2024-02-03', 'モニター', '電子機器', '名古屋', 4, 30000, 120000),
(56, '2024-02-03', 'キーボード', '電子機器', '福岡', 20, 5000, 100000),
(57, '2024-02-04', 'ボールペン', '文房具', '東京', 150, 150, 22500),
(58, '2024-02-04', 'ノート', '文房具', '札幌', 80, 200, 16000),
(59, '2024-02-05', 'コーヒー', '食品', '名古屋', 40, 500, 20000),
(60, '2024-02-05', 'お茶', '食品', '大阪', 55, 300, 16500),
(61, '2024-02-06', 'ノートPC', '電子機器', '東京', 5, 80000, 400000),
(62, '2024-02-06', 'マウス', '電子機器', '福岡', 25, 2000, 50000),
(63, '2024-02-07', 'デスク', '家具', '札幌', 2, 25000, 50000),
(64, '2024-02-07', 'チェア', '家具', '名古屋', 9, 15000, 135000),
(65, '2024-02-08', 'モニター', '電子機器', '大阪', 6, 30000, 180000),
(66, '2024-02-08', 'キーボード', '電子機器', '東京', 22, 5000, 110000),
(67, '2024-02-09', 'ボールペン', '文房具', '福岡', 110, 150, 16500),
(68, '2024-02-09', 'ノート', '文房具', '大阪', 65, 200, 13000),
(69, '2024-02-10', 'コーヒー', '食品', '札幌', 32, 500, 16000),
(70, '2024-02-10', 'お茶', '食品', '東京', 60, 300, 18000),
(71, '2024-02-11', 'ノートPC', '電子機器', '名古屋', 2, 80000, 160000),
(72, '2024-02-11', 'マウス', '電子機器', '大阪', 14, 2000, 28000),
(73, '2024-02-12', 'デスク', '家具', '福岡', 3, 25000, 75000),
(74, '2024-02-12', 'チェア', '家具', '札幌', 5, 15000, 75000),
(75, '2024-02-13', 'モニター', '電子機器', '東京', 7, 30000, 210000),
(76, '2024-02-13', 'キーボード', '電子機器', '名古屋', 16, 5000, 80000),
(77, '2024-02-14', 'ボールペン', '文房具', '大阪', 130, 150, 19500),
(78, '2024-02-14', 'ノート', '文房具', '福岡', 75, 200, 15000),
(79, '2024-02-15', 'コーヒー', '食品', '東京', 45, 500, 22500),
(80, '2024-02-15', 'お茶', '食品', '札幌', 38, 300, 11400),
(81, '2024-03-01', 'ノートPC', '電子機器', '大阪', 4, 80000, 320000),
(82, '2024-03-01', 'マウス', '電子機器', '東京', 22, 2000, 44000),
(83, '2024-03-02', 'デスク', '家具', '名古屋', 5, 25000, 125000),
(84, '2024-03-02', 'チェア', '家具', '福岡', 10, 15000, 150000),
(85, '2024-03-03', 'モニター', '電子機器', '札幌', 5, 30000, 150000),
(86, '2024-03-03', 'キーボード', '電子機器', '大阪', 25, 5000, 125000),
(87, '2024-03-04', 'ボールペン', '文房具', '東京', 200, 150, 30000),
(88, '2024-03-04', 'ノート', '文房具', '名古屋', 90, 200, 18000),
(89, '2024-03-05', 'コーヒー', '食品', '福岡', 50, 500, 25000),
(90, '2024-03-05', 'お茶', '食品', '大阪', 65, 300, 19500),
(91, '2024-03-06', 'ノートPC', '電子機器', '札幌', 3, 80000, 240000),
(92, '2024-03-06', 'マウス', '電子機器', '名古屋', 16, 2000, 32000),
(93, '2024-03-07', 'デスク', '家具', '東京', 3, 25000, 75000),
(94, '2024-03-07', 'チェア', '家具', '大阪', 12, 15000, 180000),
(95, '2024-03-08', 'モニター', '電子機器', '福岡', 8, 30000, 240000),
(96, '2024-03-08', 'キーボード', '電子機器', '札幌', 14, 5000, 70000),
(97, '2024-03-09', 'ボールペン', '文房具', '名古屋', 95, 150, 14250),
(98, '2024-03-09', 'ノート', '文房具', '東京', 85, 200, 17000),
(99, '2024-03-10', 'コーヒー', '食品', '大阪', 38, 500, 19000),
(100, '2024-03-10', 'お茶', '食品', '福岡', 48, 300, 14400);
EOSQL

echo "Sample data inserted successfully" > /tmp/data_insert_complete.txt
EOF

  tags = {
    Name = "sales-bastion"
  }

  depends_on = [aws_db_instance.sales_db]
}
```

**outputs.tf**:
```hcl
output "rds_endpoint" {
  description = "RDS endpoint"
  value       = aws_db_instance.sales_db.address
}

output "bastion_public_ip" {
  description = "Bastion server public IP"
  value       = aws_instance.bastion.public_ip
}
```

**main.tf**:
```hcl
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = "ap-northeast-1"
}
```

### Terraformの実行手順

```bash
# 初期化
terraform init

# 変数を設定（terraform.tfvarsを作成するか、コマンドラインで指定）
# terraform.tfvars の例:
# db_password = "YourSecurePassword123!"
# key_name    = "your-key-pair-name"

# 実行計画の確認
terraform plan

# リソースの作成
terraform apply

# 踏み台サーバにSSH接続してデータ投入を確認
ssh -i <your-key.pem> ec2-user@<bastion_public_ip>
cat /tmp/data_insert_complete.txt
```

## 動作確認
- ETL処理により、データベースのデータがParquet形式に変換され、ストレージに保存されていること
- クエリエンジンで下記「動作確認用SQLクエリ」が正常に実行できること
- BIツールでダッシュボードが作成され、各グラフが正しく表示されること

## 動作確認用SQLクエリ

クエリエンジンで以下のSQLクエリが正常に実行できることを確認してください。

### クエリ1：カテゴリ別売上合計
```sql
SELECT
    category,
    SUM(total_amount) as total_sales,
    COUNT(*) as transaction_count
FROM sales
GROUP BY category
ORDER BY total_sales DESC;
```

期待される結果例：
| category | total_sales | transaction_count |
| :--- | :--- | :--- |
| 電子機器 | 5,000,000 | 40 |
| 家具 | 1,800,000 | 24 |
| 文房具 | 300,000 | 20 |
| 食品 | 350,000 | 16 |

### クエリ2：地域別・月別売上
```sql
SELECT
    region,
    DATE_FORMAT(sale_date, '%Y-%m') as sale_month,
    SUM(total_amount) as monthly_sales
FROM sales
GROUP BY region, DATE_FORMAT(sale_date, '%Y-%m')
ORDER BY region, sale_month;
```

### クエリ3：商品別売上ランキング（トップ5）
```sql
SELECT
    product_name,
    SUM(quantity) as total_quantity,
    SUM(total_amount) as total_sales
FROM sales
GROUP BY product_name
ORDER BY total_sales DESC
LIMIT 5;
```

### クエリ4：日別売上推移
```sql
SELECT
    sale_date,
    SUM(total_amount) as daily_sales
FROM sales
GROUP BY sale_date
ORDER BY sale_date;
```

## ダッシュボード仕様

BIツールで以下のグラフを作成してください。

### グラフ1：カテゴリ別売上構成（円グラフ）
- **グラフ種類**: 円グラフ（Pie Chart）
- **表示内容**: 各カテゴリの売上金額の割合
- **目的**: 売上構成比を一目で把握する

### グラフ2：月別売上推移（折れ線グラフ）
- **グラフ種類**: 折れ線グラフ（Line Chart）
- **X軸**: 月（2024年1月〜3月）
- **Y軸**: 売上金額
- **目的**: 売上の月次トレンドを把握する

### グラフ3：地域別売上比較（棒グラフ）
- **グラフ種類**: 横棒グラフ（Horizontal Bar Chart）
- **表示内容**: 各地域の売上金額
- **目的**: 地域ごとの売上パフォーマンスを比較する

### グラフ4：商品別売上ランキング（棒グラフ）
- **グラフ種類**: 縦棒グラフ（Vertical Bar Chart）
- **表示内容**: 売上上位5商品の売上金額
- **目的**: 主力商品を把握する

### ダッシュボードレイアウト例
```
+-------------------+-------------------+
|                   |                   |
|  カテゴリ別売上   |   月別売上推移    |
|   （円グラフ）    |  （折れ線グラフ） |
|                   |                   |
+-------------------+-------------------+
|                   |                   |
|   地域別売上      |  商品別ランキング |
|  （横棒グラフ）   |  （縦棒グラフ）   |
|                   |                   |
+-------------------+-------------------+
```

## ヒント

- AWSにはデータベースからデータを抽出・変換・ロードするためのETLサービスがあります
- Parquet形式は列指向フォーマットで、分析クエリに適しています
- データカタログを使うと、スキーマ情報を自動的に検出できます
- サーバレスのクエリエンジンを使用すると、ストレージ上のデータに直接SQLを実行できます
- BIツールはクエリエンジンと連携してデータを可視化できます

## トラブルシューティング

### RDSに接続できない
- セキュリティグループでインバウンドルール（ポート3306）が許可されているか確認してください
- RDSインスタンスが「利用可能」状態になっているか確認してください
- パブリックアクセスが有効になっているか確認してください（初期設定時のみ）

### Glueジョブが失敗する
- Glueの実行ロールにS3への書き込み権限があるか確認してください
- JDBCコネクションの設定（エンドポイント、ポート、データベース名）が正しいか確認してください
- VPC設定が正しいか確認してください（Glueからプライベートサブネット内のRDSに接続する場合、NATゲートウェイまたはVPCエンドポイントが必要です）
- セキュリティグループでGlueからの接続が許可されているか確認してください

### Glueクローラーでテーブルが検出されない
- S3バケットにParquetファイルが正しく出力されているか確認してください
- クローラーのデータソースパスが正しいか確認してください
- クローラーの実行ロールにS3への読み取り権限があるか確認してください

### Athenaでクエリが失敗する
- Glueデータカタログにテーブルが作成されているか確認してください
- クエリ結果の出力先S3バケットが設定されているか確認してください
- テーブルのスキーマ（カラム名、データ型）が正しいか確認してください
- Athenaの実行ロールにS3への読み取り権限があるか確認してください

### Athenaでの日付関数について
- Athenaでは `DATE_FORMAT` の代わりに `date_format` を使用します
- 例: `date_format(sale_date, '%Y-%m')`

### QuickSightでデータソースに接続できない
- QuickSightがAthenaへのアクセス権限を持っているか確認してください
- QuickSightのセキュリティ設定でS3バケットへのアクセスが許可されているか確認してください
- QuickSightアカウントが正しいリージョンに作成されているか確認してください

### QuickSightでグラフが表示されない
- データセットが正しく作成されているか確認してください
- フィールドのデータ型（数値、日付、文字列）が正しく認識されているか確認してください
- 集計設定（SUM、COUNT等）が正しいか確認してください

### QuickSightの料金について
- QuickSightには無料トライアル期間があります
- 課題完了後は、QuickSightアカウントを削除することで追加料金を防げます
- Standard Edition と Enterprise Edition で料金が異なります

### データ型の注意点
- Parquet形式に変換する際、日付型が正しく変換されているか確認してください
- 金額フィールドは整数または浮動小数点型として扱ってください
- 文字列フィールドの文字コードはUTF-8を使用してください
