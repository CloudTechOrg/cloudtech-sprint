# 最終課題：総合ハンズオン課題

## 背景

あなたは、CloudTechホテルというホテルチェーンで働くインフラエンジニアです。

現在、ホテルの宿泊者からの「口コミ」を受け付けるシステムのリリースが企画されています。システムは、フロントエンド（Webサイト）とバックエンド（API）の二つで構成されています。

あなたはこのシステムが安定稼働するようなインフラ構成を構築するように求められました。

これまでのスプリントで学習したスキルを総動員し、下記要件を満たすシステムの設計・構築を行いましょう。

## 実施手順

1. まずは要件を実現するための設計として、AWS構成図を作成しましょう。
2. 構成図に従い、実際にAWSで環境構築してみましょう。
3. 構築が終わったら、動作確認をしていきましょう。

## 要件

### 要件1：フロントエンド
- 下記のリポジトリにあるコードを利用する
    - ToDo：ここにリポジトリのURLを記載
- CloudFront/S3にで動作させる

### 要件2：バックエンドAPI
- 下記のリポジトリにあるコードを利用する
    - ToDo：ここにリポジトリのURLを記載
- ECS/Fargateにで動作させる

### 要件3：データベース
- 口コミデータを永続化するためのデータベースを構築する
- DynamoDBまたはRDS（MySQL）を使用する
- テーブルの初期構築は、APIの初回起動時に作成されるため不要

### 要件4：ネットワーク
- VPCを作成し、適切なサブネット構成を設計する
- セキュリティグループで必要な通信のみを許可する

### 要件5：冗長化
- ALBを使用してトラフィックを分散する
- Auto Scalingで負荷に応じたスケーリングを実現する

### 要件6：独自ドメイン
- Route 53で独自ドメインを管理する
- ACMで証明書を取得し、CloudFrontおよびALBのエンドポイントに対してHTTPS通信を実現する

### 要件7：IaC（Infrastructure as Code）
- Terraformでインフラ構成をコード化する（CloudFormationでも可）

### 要件8：デプロイ自動化（任意）
- APIサーバ
    - CodePipeline + CodeBuildでCI/CDパイプラインを構築する
    - GitHubへのプッシュをトリガーに、ECS/Fargateへの自動デプロイを実現する
    - （任意）Blue/Greenデプロイメントを実装する
- Webサーバ
    - CoceBuildで自動デプロイを構築する
    - GitHubへのプッシュをトリガーに、S3バケットの資材を更新し、CloudFrontに反映させる

### 要件9：口コミ分析AI（任意）
- 日時で動作するStep Functionsのワークフローを作成する
- EventBridgeで定期実行をスケジュールする
- Lambda関数からAmazon Bedrockを使用して、投稿された口コミを分析し、すぐに対応（改善）が必要な内容を洗い出し、メールにて管理者（任意のメールアドレス）に通知する

### 要件10：レポート自動生成（任意）
- Step Functionsで口コミの集計レポートを自動生成するワークフローを構築する
- EventBridgeで定期実行をスケジュールする
- レポートは、任意のS3バケットに保存する
- レポートは、Bedrockを経由した生成AIにて、指定フォーマットで出力させる
- レポートのフォーマットは下記の通り

### 要件11：データ分析基盤（任意）
- Glueで口コミデータをETL処理する
- Athenaでデータをクエリする
- （任意）QuickSightでダッシュボードを作成する

### 要件12：マルチアカウント（任意）
- AWS Organizationsで本番環境と開発環境をアカウントレベルで分離する
- さらに、データ分析基盤も別環境にする（これは本番のみ対象）
- SCPで任意のガバナンスポリシーを設定する

## 要件13：セキュリティ
- WAFを活用し、CloudFrontおよびALBのエンドポイントの通信を保護する
- GuardDutyを活用し、不審なるふまいを検知させる
- （余裕があれば）これらもデータ分析基盤でデータを確認できるようにする

## ガバナンス
- CloudTrailにて、AWSの操作履歴が見れるようにする
- 下記のレイヤー該当するIAMユーザを作成し、適切な権限を与える
    - 開発担当者
    - インフラ担当者
    - データ分析者
    - 管理者

## オブザーバビリティ（可視化）
- ECS/FargateのCPU使用率、メモリ使用率をモニタリングし、1分間の平均が70%を超えた場合は、メールあるいは任意のSlackにアラートを通知する
- ECS/Fargateでエラーが発生した場合、同じく任意のメールまたはSlackチャンネルにアラートを通知する
- 他要件で設定したWAFのアクセス履歴、GuardDutyの検知履歴、CloudTrailの操作履歴について、データ分析基盤にて、Athenaで参照できるようにする


## 提出物（Academy受講生のみ）
- AWS構成図
- 上記要件を満たすTerraformのコード

※技術メンターがTerraformコードを実行し、動作確認します。

## 動作確認
- 独自ドメインでWebサイトにアクセスし、口コミ投稿画面が表示されること
- 口コミを投稿し、データベースに保存されること
- 投稿した口コミが一覧画面に表示されること
- HTTPS通信が有効であること（ブラウザに鍵マークが表示されること）

## 参考スプリント

| 要件 | 参考スプリント |
| :--- | :--- |
| フロントエンド（S3 + CloudFront） | Sprint 4 |
| バックエンドAPI（ECS/Fargate） | Sprint 5 |
| バックエンドAPI（Lambda + API Gateway） | Sprint 8 |
| データベース（RDS） | Sprint 2 |
| データベース（DynamoDB） | Sprint 8 |
| ネットワーク（VPC） | Sprint 1、Sprint 2 |
| 冗長化（ALB + Auto Scaling） | Sprint 3 |
| 独自ドメイン（Route 53 + ACM） | Sprint 4 |
| IaC（Terraform） | Sprint 7 |
| デプロイ自動化（CodePipeline） | Sprint 6 |
| 口コミ分析AI（Bedrock） | Sprint 9 |
| レポート自動生成（Step Functions + SES） | Sprint 10 |
| データ分析基盤（Glue + Athena + QuickSight） | Sprint 11 |
| マルチアカウント（Organizations + SCP） | Sprint 12 |

## 発展的な取り組み
- 本課題で指定したサービス以外のAWSサービスを使用しても構いません
- ただし、CloudTechで扱っていないサービスについては、メンターも調べながらの回答となる場合がありますメール
