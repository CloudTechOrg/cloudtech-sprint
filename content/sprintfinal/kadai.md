# 最終課題：総合ハンズオン課題

## 背景

あなたは、CloudTechホテルというホテルチェーンで働くインフラエンジニアです。

現在、ホテルの宿泊者からの「口コミ」を受け付けるシステムのリリースが企画されています。システムは、フロントエンド（Webサイト）とバックエンド（API）の二つで構成されています。

あなたはこのシステムが安定稼働するようなインフラ構成を構築するように求められました。

これまでのスプリントで学習したスキルを総動員し、下記要件を満たすシステムの設計・構築を行いましょう。

## 実施手順

1. まずは要件を実現するための設計として、AWS構成図を作成しましょう。
2. 構成図に従い、実際にAWSで環境構築してみましょう。
3. 構築が終わったら、動作確認をしていきましょう。

## 要件

### 要件1：フロントエンド
- 下記のリポジトリにあるコードを利用する
    - https://github.com/CloudTechOrg/cloudtech-hotel-front
- CloudFront + S3で動作させる

### 要件2：バックエンドAPI
- 下記のリポジトリにあるコードを利用する
    - https://github.com/CloudTechOrg/cloudtech-hotel-api
- ECS/Fargateで動作させる

### 要件3：データベース
- 口コミデータを永続化するためのデータベースを構築する
- DynamoDBまたはRDS（MySQL）を使用する
- テーブルの初期構築は、APIの初回起動時に自動作成されるため不要

### 要件4：ネットワーク
- VPCを作成し、適切なサブネット構成を設計する
- セキュリティグループで必要な通信のみを許可する

### 要件5：冗長化
- ALBを使用してトラフィックを分散する
- Auto Scalingで負荷に応じたスケーリングを実現する

### 要件6：独自ドメイン
- Route 53で独自ドメインを管理する
- ACMで証明書を取得し、CloudFrontおよびALBに対してHTTPS通信を実現する

### 要件7：IaC（Infrastructure as Code）
- Terraform（CloudFormationでも可）での構築を推奨するが、難しい場合は手動での作成でも可

### 要件8：デプロイ自動化（任意）
- APIサーバ
    - CodePipeline + CodeBuildでCI/CDパイプラインを構築する
    - GitHubへのプッシュをトリガーに、ECS/Fargateへの自動デプロイを実現する
    - （任意）Blue/Greenデプロイメントを実装する
- Webサーバ
    - CodeBuildで自動デプロイを構築する
    - GitHubへのプッシュをトリガーに、S3バケットの資材を更新し、CloudFrontのキャッシュを無効化する

### 要件9：口コミ分析レポート自動生成（任意）
- Step Functionsで口コミの分析レポートを自動生成するワークフローを構築する
- EventBridgeで定期実行（毎日または毎週）をスケジュールする
- Lambda関数からAmazon Bedrockを使用して、投稿された口コミを分析する
- レポートはS3バケットに保存する
- レポートの生成完了後、SNS経由でメールまたはSlackに通知する

#### レポートフォーマット（例）
```
=====================================
    CloudTechホテル 口コミ分析レポート
    対象期間: 2024-01-01 〜 2024-01-07
=====================================

【サマリー】
  総口コミ数: 50件
  ポジティブ: 35件（70%）
  ネガティブ: 10件（20%）
  中立: 5件（10%）

【ポジティブな口コミの傾向】
  - スタッフの対応が良い（15件）
  - 部屋が清潔（10件）
  - 立地が便利（8件）

【ネガティブな口コミの傾向】
  - Wi-Fiが遅い（4件）
  - チェックイン待ち時間が長い（3件）
  - 朝食のメニューが少ない（2件）

【要対応事項】
  1. Wi-Fi設備の改善検討
  2. チェックイン業務の効率化
  3. 朝食メニューの見直し

=====================================
    レポート生成日時: 2024-01-08 09:00:00
=====================================
```

### 要件10：データ分析基盤（任意）
- Glueで口コミデータをETL処理する
- Athenaでデータをクエリできるようにする
- （任意）QuickSightでダッシュボードを作成する

### 要件11：マルチアカウント（任意）
- AWS Organizationsで本番環境と開発環境をアカウントレベルで分離する
- SCPで任意のガバナンスポリシーを設定する
- （高難度）データ分析基盤も別アカウントに分離し、Glue以降はデータ分析基盤のアカウントで実行（本番環境のみ対象）

### 要件12：セキュリティ（任意）
- AWS WAFを使用して、CloudFrontおよびALBへの通信を保護する
- Amazon GuardDutyを使用して、不審なふるまいを検知する

### 要件13：ガバナンス（任意）
- CloudTrailを有効化し、AWSの操作履歴を記録する
- 下記の役割に応じたIAMユーザーを作成し、適切な権限を付与する
    - 開発担当者
    - インフラ担当者
    - データ分析者
    - 管理者

### 要件14：オブザーバビリティ（任意）
- CloudWatch Alarmsを使用して、ECS/FargateのCPU使用率・メモリ使用率をモニタリングする
- 1分間の平均が70%を超えた場合、SNS経由でメールまたはSlackにアラートを通知する
- ECS/Fargateでエラーが発生した場合も、CloudWatchのサブスクリプションフィルターとLambda関数を組み合わせて、同様にアラートを通知する
- （高難度）WAFのアクセスログ、GuardDutyの検知履歴、CloudTrailの操作履歴をデータ分析基盤でAthenaから参照できるようにする

## 提出物（Academy受講生のみ）
- AWS構成図
- 下記いずれかの方法で提出
    - IaCで構築した場合：Terraform（またはCloudFormation）のコードを提出
    - 手動で構築した場合：技術メンター用のIAMユーザーを作成し、認証情報を共有

## 発展的な取り組み
- 本課題で指定したサービス以外のAWSサービスを使用しても構いません
- ただし、CloudTechで扱っていないサービスについては、メンターも調べながらの回答となる場合があります
