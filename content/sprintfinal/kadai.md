# 最終課題：総合ハンズオン課題

## 背景

あなたは、CloudTechホテルというホテルチェーンで働くインフラエンジニアです。

現在、ホテルの宿泊者からの「口コミ」を受け付けるシステムのリリースが企画されています。システムは、フロントエンド（Webサイト）とバックエンド（API）の二つで構成されています。

あなたはこのシステムが安定稼働するようなインフラ構成を構築するように求められました。

これまでのスプリントで学習したスキルを総動員し、下記要件を満たすシステムの設計・構築を行いましょう。

## 実施手順

1. まずは要件を実現するための設計として、AWS構成図を作成しましょう。
2. 構成図に従い、実際にAWSで環境構築してみましょう。
3. 構築が終わったら、動作確認をしていきましょう。

## 要件

### 要件1：フロントエンド
- 下記のリポジトリにあるコードを利用する
    - ToDo：ここにリポジトリのURLを記載
- CloudFront + S3で動作させる

### 要件2：バックエンドAPI
- 下記のリポジトリにあるコードを利用する
    - ToDo：ここにリポジトリのURLを記載
- ECS/Fargateで動作させる

### 要件3：データベース
- 口コミデータを永続化するためのデータベースを構築する
- DynamoDBまたはRDS（MySQL）を使用する
- テーブルの初期構築は、APIの初回起動時に自動作成されるため不要

### 要件4：ネットワーク
- VPCを作成し、適切なサブネット構成を設計する
- セキュリティグループで必要な通信のみを許可する

### 要件5：冗長化
- ALBを使用してトラフィックを分散する
- Auto Scalingで負荷に応じたスケーリングを実現する

### 要件6：独自ドメイン
- Route 53で独自ドメインを管理する
- ACMで証明書を取得し、CloudFrontおよびALBに対してHTTPS通信を実現する

### 要件7：IaC（Infrastructure as Code）
- Terraformでインフラ構成をコード化する（CloudFormationでも可）

### 要件8：デプロイ自動化（任意）
- APIサーバ
    - CodePipeline + CodeBuildでCI/CDパイプラインを構築する
    - GitHubへのプッシュをトリガーに、ECS/Fargateへの自動デプロイを実現する
    - （任意）Blue/Greenデプロイメントを実装する
- Webサーバ
    - CodeBuildで自動デプロイを構築する
    - GitHubへのプッシュをトリガーに、S3バケットの資材を更新し、CloudFrontのキャッシュを無効化する

### 要件9：口コミ分析AI（任意）
- 定期的に動作するStep Functionsのワークフローを作成する
- EventBridgeで定期実行をスケジュールする
- Lambda関数からAmazon Bedrockを使用して、投稿された口コミを分析し、すぐに対応（改善）が必要な内容を洗い出す
- SESを使用して、分析結果を管理者（任意のメールアドレス）に通知する

### 要件10：レポート自動生成（任意）
- Step Functionsで口コミの集計レポートを自動生成するワークフローを構築する
- EventBridgeで定期実行をスケジュールする
- レポートは任意のS3バケットに保存する
- レポートはBedrockを使用して、指定フォーマットで出力する
- レポートのフォーマットは下記の通り
    - ToDo：フォーマットを記載

### 要件11：データ分析基盤（任意）
- Glueで口コミデータをETL処理する
- Athenaでデータをクエリできるようにする
- （任意）QuickSightでダッシュボードを作成する

### 要件12：マルチアカウント（任意）
- AWS Organizationsで本番環境と開発環境をアカウントレベルで分離する
- データ分析基盤も別アカウントに分離する（本番環境のみ対象）
- SCPで任意のガバナンスポリシーを設定する

### 要件13：セキュリティ（任意）
- AWS WAFを使用して、CloudFrontおよびALBへの通信を保護する
- Amazon GuardDutyを使用して、不審なふるまいを検知する
- （任意）これらのログもデータ分析基盤で確認できるようにする

### 要件14：ガバナンス（任意）
- CloudTrailを有効化し、AWSの操作履歴を記録する
- 下記の役割に応じたIAMユーザーを作成し、適切な権限を付与する
    - 開発担当者
    - インフラ担当者
    - データ分析者
    - 管理者

### 要件15：オブザーバビリティ（任意）
- CloudWatch Alarmsを使用して、ECS/FargateのCPU使用率・メモリ使用率をモニタリングする
- 1分間の平均が70%を超えた場合、SNS経由でメールまたはSlackにアラートを通知する
- ECS/Fargateでエラーが発生した場合も、同様にアラートを通知する
- （任意）WAFのアクセスログ、GuardDutyの検知履歴、CloudTrailの操作履歴をデータ分析基盤でAthenaから参照できるようにする

## 提出物（Academy受講生のみ）
- AWS構成図
- 上記要件を満たすTerraform（またはCloudFormation）のコード

※技術メンターがコードを実行し、動作確認します。

## 動作確認
- 独自ドメインでWebサイトにアクセスし、口コミ投稿画面が表示されること
- 口コミを投稿し、データベースに保存されること
- 投稿した口コミが一覧画面に表示されること
- HTTPS通信が有効であること（ブラウザに鍵マークが表示されること）

## 参考スプリント

| 要件 | 参考スプリント |
| :--- | :--- |
| フロントエンド（S3 + CloudFront） | Sprint 4 |
| バックエンドAPI（ECS/Fargate） | Sprint 5 |
| データベース（RDS） | Sprint 2 |
| データベース（DynamoDB） | Sprint 8 |
| ネットワーク（VPC） | Sprint 1、Sprint 2 |
| 冗長化（ALB + Auto Scaling） | Sprint 3 |
| 独自ドメイン（Route 53 + ACM） | Sprint 4 |
| IaC（Terraform） | Sprint 7 |
| デプロイ自動化（CodePipeline） | Sprint 6 |
| 口コミ分析AI（Bedrock） | Sprint 9 |
| レポート自動生成（Step Functions） | Sprint 10 |
| データ分析基盤（Glue + Athena + QuickSight） | Sprint 11 |
| マルチアカウント（Organizations + SCP） | Sprint 12 |

## 発展的な取り組み
- 本課題で指定したサービス以外のAWSサービスを使用しても構いません
- ただし、CloudTechで扱っていないサービスについては、メンターも調べながらの回答となる場合があります
